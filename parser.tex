
% token type enum
\def\tokentypeEND{0}
\def\enumnext#1{%
	\e\edef\csname tokentype#1\endcsname{\tokentypeEND}%
	\edef\tokentypeEND{\the\numexpr\tokentypeEND+1}%
}

\enumnext{NEWLINE}

\enumnext{IDENTIFIER}
\enumnext{NUMBER}

\enumnext{AND}
\enumnext{OR}
\enumnext{NOT}
\enumnext{IS}
\enumnext{ISNOT}
\enumnext{IN}
\enumnext{NOTIN}

\enumnext{ADD}
\enumnext{SUBTRACT}
\enumnext{MULTIPLY}
\enumnext{DIVIDE}
\enumnext{FLOORDIVIDE}
\enumnext{EXPONENTIATION}
\enumnext{MODULO}

\enumnext{EQUAL}
\enumnext{NOTEQUAL}
\enumnext{LESSTHAN}
\enumnext{LESSEQUAL}
\enumnext{GREATER}
\enumnext{GREATEREQUAL}

\enumnext{ASSIGN}




% token macros - sets \toketype and, optionally, \tokenvalue
\def\@pytexToken@Newline{\edef\tokentype{\tokentypeNEWLINE}}
\def\@pytexToken@Identifier#1{\def\tokentype{\tokentypeIDENTIFIER}\def\tokenvalue{#1}}
\def\@pytexToken@Number#1{\def\tokentype{\tokentypeNUMBER}\def\tokenvalue{#1}}

\def\@pytexToken@and{\def\tokentype{\tokentypeAND}}
\def\@pytexToken@or{\def\tokentype{\tokentypeOR}}
\def\@pytexToken@in{\def\tokentype{\tokentypeIN}}
\def\@pytexToken@is{\def\tokentype{\tokentypeIS}}
\def\@pytexToken@not{\def\tokentype{\tokentypeNOT}}

\def\@pytexToken@Addition{\def\tokentype{\tokentypeADD}}
\def\@pytexToken@Subtraction{\def\tokentype{\tokentypeSUBTRACT}}
\def\@pytexToken@Multiplication{\def\tokentype{\tokentypeMULTIPLY}}
\def\@pytexToken@Division{\def\tokentype{\tokentypeDIVIDE}}
\def\@pytexToken@FloorDivision{\def\tokentype{\tokentypeFLOORDIVIDE}}
\def\@pytexToken@EqualTo{\def\tokentype{\tokentypeEQUAL}}
\def\@pytexToken@NotEqualTo{\def\tokentype{\tokentypeNOTEQUAL}}
\def\@pytexToken@Exponentiation{\def\tokentype{\tokentypeEXPONENTIATION}}
\def\@pytexToken@Modulo{\def\tokentype{\tokentypeMODULO}}

\def\@pytexToken@Assignment{\def\tokentype{\tokentypeASSIGN}}

\def\ifmatch#1{%
	\e\@pytexTokeniser@TokenList@getim\e{\currentidx}%
	\ifnum \tokentype = #1 %
		\edef\currentidx{\the\numexpr\currentidx+1}%
}
\def\ifpeek#1{%
	\e\@pytexTokeniser@TokenList@getim\e{\currentidx}%
	\ifnum \tokentype = #1 %
}



\def\currentidx{0}

\def\savestate#1{%
	\e\e\e\edef\csname currentidx@#1\endcsname{\currentidx}%
}
\def\restorestate#1{%
	\edef\currentidx{\csname currentidx@#1\endcsname}
	\e\e\e\let\csname currentidx@#1\endcsname\undefined%
	%\e\@pytexTokeniser@TokenList@getim\e{\currentidx}%
}
%\def\commitstate#1{%
%	\e\e\e\let\csname currentidx@#1\endcsname\undefined%
%}

% #1 = if, #2 = iftrue, #3 = iffalse
\def\wrapif#1#2#3{
	#1 %
		#2 %
	\else %
		#3 %
	\fi %
}



\input{parser/expression.tex}












\def\@pytexParser@statementAssign{ %
	\@pytexLocal@begin{current}%
%
%	
%	
	\@pytexLocal@end{current}%
}

\def\@pytexParser@skipEmptyLines{%
	\ifmatch{0}%
		\def\next{\@pytexParser@skipEmptyLines}%
	\else%
		\def\next{\relax}%
	\fi%
	\next%
}

\def\@pytexParser@statement{%
	\@pytexParser@skipEmptyLines%
	\@pytexParser@expression% TODO: expect newline after (or ';')
}

\def\@pytexParser@parseNext{%
	\def\parseNext{\relax}%
	\ifnum \@pytexTokeniser@TokenList@size > 0 %
		\@pytexParser@statement%
		\show\@pytexTMP@parserReturnValue%
	\fi %
	\parseNext%
}

\def\@pytexParser@parse{
	\@pytexLocal@new{current}%
	\@pytexTokeniser@TokenList@peekim%
	
	\@pytexParser@parseNext%
	
	\let\@pytexTMP@parserReturnValue\undefined%
}




