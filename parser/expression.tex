% https://www.programiz.com/python-programming/precedence-associativity
% https://www.wscubetech.com/resources/python/precedence-associativity-operators
% https://docs.python.org/3/reference/expressions.html#grammar-token-python-grammar-primary

% try<thing> looks ahead and tries to parse <thing>.
% if parsing was succesful:
	% sets \@pytexTMP@parserReturnValue to the parsed construct
	% consumes the parsed tokens
	% ends with \iftrue
% else,
	% leaves \@pytexTMP@parserReturnValue untouched
	% leaves tokens untouched
	% ends with \iffalse
% use \wrapif{\try<thing>}{<iftrue>}{<iffalse>} to avoid problems with ifs

\def\@pytexParser@NotImplemented{\iffalse}%



% expression:
%     | disjunction 'if' disjunction 'else' expression 
%     | disjunction
%     | lambdef
\def\@pytexParser@tryExpression{%
	\@pytexParser@choiceThree%
		{\@pytexParser@NotImplemented}% TODO
		{\@pytexParser@tryDisjunction}%
		{\@pytexParser@NotImplemented}% TODO
}

% yield_expr:
%     | 'yield' 'from' expression 
%     | 'yield' [star_expressions] 
% TODO

% star_expressions:
%     | star_expression (',' star_expression )+ [','] 
%     | star_expression ',' 
%     | star_expression
% TODO

% star_expression:
%     | '*' bitwise_or 
%     | expression
% TODO

% star_named_expressions: ','.star_named_expression+ [','] 
% TODO

% star_named_expression:
%     | '*' bitwise_or 
%     | named_expression
% TODO

% assignment_expression:
%     | NAME ':=' ~ expression 
% TODO

% named_expression:
%     | assignment_expression
%     | expression !':='
% TODO


% disjunction:
%     | conjunction ('or' conjunction )+ 
%     | conjunction
\def\@pytexParser@tryDisjunction{%
	\@pytexParser@tryConjunction%
		\@pytexLocal@begin{current}%
		\e\def\e\current\e{\@pytexTMP@parserReturnValue}%
		%
		\@pytexParser@tryDisjunctionNext%
		%
		\e\def\e\@pytexTMP@parserReturnValue\e{\current}%
		\@pytexLocal@end{current}%
}
\def\@pytexParser@tryDisjunctionNext{%
	\@pytexParser@join{\@pytexParser@tryToken{\tokentypeOR}}{\@pytexParser@tryConjunction}%
		{\e\e\e\def\e\e\e\current\e\e\e{\e\e\e\@pytexOperator@or\e\e\e{\e\current\e}\e{\@pytexTMP@parserReturnValue}}}%
		\def\next{\@pytexParser@tryDisjunctionNext}%
	\else%
		\def\next{\relax}%
	\fi%
	\next%
}


% conjunction:
%     | inversion ('and' inversion )+ 
%     | inversion
\def\@pytexParser@tryConjunction{%
	\@pytexParser@tryInversion
		\@pytexLocal@begin{current}%
		\e\def\e\current\e{\@pytexTMP@parserReturnValue}%
		\@pytexParser@tryConjunctionNext%
		\e\def\e\@pytexTMP@parserReturnValue\e{\current}%
		\@pytexLocal@end{current}%
}
\def\@pytexParser@tryConjunctionNext{%
	\@pytexParser@join{\@pytexParser@tryToken{\tokentypeAND}}{\@pytexParser@tryInversion}%
		{\e\e\e\def\e\e\e\current\e\e\e{\e\e\e\@pytexOperator@and\e\e\e{\e\current\e}\e{\@pytexTMP@parserReturnValue}}}%
		\def\next{\@pytexParser@tryConjunctionNext}%
	\else%
		\def\next{\relax}%
	\fi%
	\next%
}



% inversion:
%     | 'not' inversion 
%     | comparison
\def\@pytexParser@tryInversion{%
	\@pytexParser@choice{\@pytexParser@tryComparison}%
		{%
			\@pytexParser@join{\@pytexParser@tryToken{\tokentypeNOT}} {\@pytexParser@tryInversion}%
				{\e\def\e\@pytexTMP@parserReturnValue\e{\e\@pytexOperator@not\e{\second}}}%
		}%
}







% TODO: move this
% https://docs.python.org/3/reference/grammar.html
% star_expression:
%     | '*' bitwise_or 
%     | expression
\def\@pytexParser@tryStarExpression{%
	\@pytexParser@choice%
		{\@pytexParser@joinSecondUnary%
			{\@pytexParser@tryToken{\tokentypeMULTIPLY}}%
			{\@pytexParser@tryBitwiseOr}%
			{\e\def\e\@pytexTMP@parserReturnValue\e{\e\@pytexOperator@starred\e{\@pytexTMP@parserReturnValue}}}%
		}%
		{\@pytexParser@tryExpression}%
}



